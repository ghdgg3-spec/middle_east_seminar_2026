window.addEventListener("DOMContentLoaded", () => {

/* ========= Video ========= */
const opening = document.getElementById("videoOpening");
const video = document.getElementById("openingVideo");
const page = document.getElementById("page");

function stopVideoHard(){
  try{
    video.pause();
    video.currentTime = 0;
    video.removeAttribute("src");
    const srcEl = video.querySelector("source");
    if(srcEl) srcEl.removeAttribute("src");
    video.load();
  } catch(e){}
}

function endOpening(){
  page.style.opacity = "1";
  stopVideoHard();
  opening.classList.add("hidden");
  opening.addEventListener("transitionend", () => opening.remove(), { once:true });
}

if(video){
  video.addEventListener("ended", endOpening);
}

/* ========= Hamburger ========= */
function toggleMenu(){
  document.getElementById("navLinks").classList.toggle("show");
}
window.toggleMenu = toggleMenu;

/* ========= Scroll reveal ========= */
const contentSections = document.querySelectorAll("section.content");
function revealOnScroll(){
  contentSections.forEach(sec => {
    if(sec.getBoundingClientRect().top < window.innerHeight - 120){
      sec.classList.add("visible");
    }
  });
}
window.addEventListener("scroll", revealOnScroll);
window.addEventListener("load", revealOnScroll);

/* ========= Active nav highlight ========= */
const navA = document.querySelectorAll(".nav-links a");
function highlightNav(){
  navA.forEach(a => {
    const sec = document.querySelector(a.getAttribute("href"));
    if(!sec) return;
    const r = sec.getBoundingClientRect();
    if(r.top <= 110 && r.bottom >= 110){
      navA.forEach(x => x.classList.remove("active"));
      a.classList.add("active");
    }
  });
}
window.addEventListener("scroll", highlightNav);
window.addEventListener("load", highlightNav);

/* ========= Language ========= */
const navLangBtn = document.getElementById("langBtn");
const btnEN = document.getElementById("langEN");
const btnKR = document.getElementById("langKR");
const transEls = Array.from(document.querySelectorAll("[data-en]"));

function setLang(lang){
  transEls.forEach(el => {
    el.innerHTML = (lang === "kr") ? el.dataset.kr : el.dataset.en;
  });
  navLangBtn.innerText = (lang === "kr") ? "KR" : "EN";
}

function toggleLang(){
  setLang(navLangBtn.innerText.trim().toLowerCase() === "kr" ? "en" : "kr");
}

function chooseLangAndEnter(lang){
  setLang(lang);
  endOpening();
}

if(btnEN) btnEN.addEventListener("click", () => chooseLangAndEnter("en"));
if(btnKR) btnKR.addEventListener("click", () => chooseLangAndEnter("kr"));
if(navLangBtn) navLangBtn.addEventListener("click", toggleLang);

/* ========= Lucky Draw ========= */
function flipCard(card){
  card.classList.toggle("flipped");
}
window.flipCard = flipCard;

});
